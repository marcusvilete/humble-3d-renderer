(()=>{"use strict";var t,e,n=(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}),r=function(){function t(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}return t.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},t.normalize=function(e){var n=t.magnitude(e);return n>0?t.divide(e,n):new t(0,0)},t.add=function(e,n){return new t(e.x+n.x,e.y+n.y)},t.subtract=function(e,n){return new t(e.x-n.x,e.y-n.y)},t.multiply=function(e,n){return new t(e.x*n,e.y*n)},t.divide=function(e,n){return new t(e.x/n,e.y/n)},t.dotProduct=function(t,e){return t.x*e.x+t.y*e.y},t}(),o=function(t){function e(e,n,r){var o=t.call(this,null!=e?e:0,null!=n?n:0)||this;return o.z=null!=r?r:0,o}return n(e,t),e.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},e.normalize=function(t){var n=e.magnitude(t);return n>0?e.divide(t,n):new e(0,0,0)},e.add=function(t,n){return new e(t.x+n.x,t.y+n.y,t.z+n.z)},e.subtract=function(t,n){return new e(t.x-n.x,t.y-n.y,t.z-n.z)},e.multiply=function(t,n){return new e(t.x*n,t.y*n,t.z*n)},e.divide=function(t,n){return new e(t.x/n,t.y/n,t.z/n)},e.dotProduct=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},e.vectorCrossProduct=function(t,n){return new e(t.y*n.z-t.z*n.y,t.z*n.x-t.x*n.z,t.x*n.y-t.y*n.x)},e.zero=new e(0,0,0),e.forward=new e(0,0,-1),e.backward=new e(0,0,1),e.up=new e(0,1,0),e.down=new e(0,-1,0),e.left=new e(-1,0,0),e.right=new e(1,0,0),e}(r),i=function(t){function e(e,n,r,o){var i=t.call(this,null!=e?e:0,null!=n?n:0,null!=r?r:0)||this;return i.w=null!=o?o:1,i}return n(e,t),e.forward=new e(0,0,-1,1),e.backward=new e(0,0,1,1),e.up=new e(0,1,0,1),e.down=new e(0,-1,0,1),e.left=new e(-1,0,0,1),e.right=new e(1,0,0,1),e}(o),a=function(){function t(t,e,n,r,o,i,a,s,c,u,l,h,f,m,x,d){this.elements=[null!=t?t:0,null!=e?e:0,null!=n?n:0,null!=r?r:0,null!=o?o:0,null!=i?i:0,null!=a?a:0,null!=s?s:0,null!=c?c:0,null!=u?u:0,null!=l?l:0,null!=h?h:0,null!=f?f:0,null!=m?m:0,null!=x?x:0,null!=d?d:0]}return t.prototype.getElementAt=function(t,e){return this.elements[4*e+t]},t.prototype.setElementAt=function(t,e,n){this.elements[4*e+t]=n},t.prototype.flatten=function(){return this.elements},t.makeIdentity=function(){return new t(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.makeScale=function(e,n,r){return new t(e,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1)},t.makeTranslation=function(e,n,r){return new t(1,0,0,0,0,1,0,0,0,0,1,0,e,n,r,1)},t.makeXRotation=function(e){var n=Math.sin(e),r=Math.cos(e);return new t(1,0,0,0,0,r,n,0,0,-n,r,0,0,0,0,1)},t.makeYRotation=function(e){var n=Math.sin(e),r=Math.cos(e);return new t(r,0,-n,0,0,1,0,0,n,0,r,0,0,0,0,1)},t.makeZRotation=function(e){var n=Math.sin(e),r=Math.cos(e);return new t(r,n,0,0,-n,r,0,0,0,0,1,0,0,0,0,1)},t.makePerspective=function(e,n,r,o){var i=Math.tan(.5*Math.PI-.5*e),a=1/(r-o);return new t(i/n,0,0,0,0,i,0,0,0,0,(r+o)*a,-1,0,0,r*o*a*2,0)},t.makeLookAtMatrix=function(e,n,r){var i=o.normalize(o.subtract(e,n)),a=o.normalize(o.vectorCrossProduct(r,i)),s=o.normalize(o.vectorCrossProduct(i,a));return new t(a.x,a.y,a.z,0,s.x,s.y,s.z,0,i.x,i.y,i.z,0,e.x,e.y,e.z,1)},t.makeViewMatrix=function(e,n,r){var i=o.normalize(o.subtract(e,n)),a=o.normalize(o.vectorCrossProduct(r,i)),s=o.vectorCrossProduct(i,a);return new t(a.x,s.x,i.x,0,a.y,s.y,i.y,0,a.z,s.z,i.z,0,-o.dotProduct(a,e),-o.dotProduct(s,e),-o.dotProduct(i,e),1)},t.multiplyMatrix4ByVector4=function(t,e){return new i(e.x*t.getElementAt(0,0)+e.y*t.getElementAt(0,1)+e.z*t.getElementAt(0,2)+e.w*t.getElementAt(0,3),e.x*t.getElementAt(1,0)+e.y*t.getElementAt(1,1)+e.z*t.getElementAt(1,2)+e.w*t.getElementAt(1,3),e.x*t.getElementAt(2,0)+e.y*t.getElementAt(2,1)+e.z*t.getElementAt(2,2)+e.w*t.getElementAt(2,3),e.x*t.getElementAt(3,0)+e.y*t.getElementAt(3,1)+e.z*t.getElementAt(3,2)+e.w*t.getElementAt(3,3))},t.multiplyMatrices4=function(e,n){for(var r=new t,o=0;o<4;o++)for(var i=0;i<4;i++){var a=n.getElementAt(o,0)*e.getElementAt(0,i)+n.getElementAt(o,1)*e.getElementAt(1,i)+n.getElementAt(o,2)*e.getElementAt(2,i)+n.getElementAt(o,3)*e.getElementAt(3,i);r.setElementAt(o,i,a)}return r},t.transpose=function(e){for(var n=new t,r=0;r<4;r++)for(var o=0;o<4;o++)n.setElementAt(r,o,e.getElementAt(o,r));return n},t.copy=function(e){for(var n=new t,r=0;r<4;r++)for(var o=0;o<4;o++)n.setElementAt(r,o,e.getElementAt(r,o));return n},t.inverse=function(e){var n=e.getElementAt(0,0),r=e.getElementAt(1,0),o=e.getElementAt(2,0),i=e.getElementAt(3,0),a=e.getElementAt(0,1),s=e.getElementAt(1,1),c=e.getElementAt(2,1),u=e.getElementAt(3,1),l=e.getElementAt(0,2),h=e.getElementAt(1,2),f=e.getElementAt(2,2),m=e.getElementAt(3,2),x=e.getElementAt(0,3),d=e.getElementAt(1,3),p=e.getElementAt(2,3),y=e.getElementAt(3,3),w=f*y,v=p*m,g=c*y,E=p*u,A=c*m,M=f*u,b=o*y,R=p*i,T=o*m,L=f*i,_=o*u,k=c*i,P=l*d,z=x*h,S=a*d,C=x*s,B=a*h,F=l*s,U=n*d,I=x*r,D=n*h,V=l*r,O=n*s,W=a*r,X=w*s+E*h+A*d-(v*s+g*h+M*d),G=v*r+b*h+L*d-(w*r+R*h+T*d),Y=g*r+R*s+_*d-(E*r+b*s+k*d),N=M*r+T*s+k*h-(A*r+L*s+_*h),j=1/(n*X+a*G+l*Y+x*N);return new t(j*X,j*G,j*Y,j*N,j*(v*a+g*l+M*x-(w*a+E*l+A*x)),j*(w*n+R*l+T*x-(v*n+b*l+L*x)),j*(E*n+b*a+k*x-(g*n+R*a+_*x)),j*(A*n+L*a+_*l-(M*n+T*a+k*l)),j*(P*u+C*m+B*y-(z*u+S*m+F*y)),j*(z*i+U*m+V*y-(P*i+I*m+D*y)),j*(S*i+I*u+O*y-(C*i+U*u+W*y)),j*(F*i+D*u+W*m-(B*i+V*u+O*m)),j*(S*f+F*p+z*c-(B*p+P*c+C*f)),j*(D*p+P*o+I*f-(U*f+V*p+z*o)),j*(U*c+W*p+C*o-(O*p+S*o+I*c)),j*(O*f+B*o+V*c-(D*c+W*f+F*o)))},t}(),s=function(){this.vertices=[],this.normals=[],this.uvCoords=[],this.drawMode=e.Texture};!function(t){t[t.Point=WebGLRenderingContext.POINTS]="Point",t[t.Wireframe=WebGLRenderingContext.LINE_STRIP]="Wireframe",t[t.SolidColor=WebGLRenderingContext.TRIANGLES]="SolidColor",t[t.Texture=WebGLRenderingContext.TRIANGLES]="Texture"}(e||(e={}));var c=function(){function t(){}return t.loadFromScript=function(t,e,n){var r=t.createShader(n);if(t.shaderSource(r,e.text),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS))return r;console.error("Something went wrong when compiling a vertex shader. More info:",t.getShaderInfoLog(r))},t.createProgram=function(t,e,n){var r=t.createProgram();return t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)?r:(console.error("Something went wrong when compiling a vertex shader. More info:",t.getShaderInfoLog(r)),t.deleteProgram(r),null)},t}(),u=function(){function t(t,e,n,r,i,a){this.position=null!=t?t:new o,this.rotation=null!=e?e:new o,this.scale=null!=n?n:new o(1,1,1),this.up=null!=r?r:o.up,this.right=null!=i?i:o.right,this.forward=null!=a?a:o.forward}return t.prototype.reset=function(){this.position=new o,this.rotation=new o,this.scale=new o(1,1,1)},t.prototype.rotate=function(t){this.rotation=o.add(this.rotation,t),this.computeDirectionVectors()},t.prototype.computeDirectionVectors=function(){var t=a.makeZRotation(this.rotation.z),e=a.makeYRotation(this.rotation.y),n=a.makeXRotation(this.rotation.x),r=a.multiplyMatrices4(e,t);r=a.multiplyMatrices4(n,r),this.up=a.multiplyMatrix4ByVector4(r,i.up),this.forward=a.multiplyMatrix4ByVector4(r,i.forward),this.right=a.multiplyMatrix4ByVector4(r,i.right)},t.prototype.rotateAround=function(t,e,n){var r=a.makeIdentity(),o=a.makeTranslation(-e.x,-e.y,-e.z),s=a.makeTranslation(e.x,e.y,e.z),c=a.makeXRotation(n.x*t),u=a.makeYRotation(n.y*t),l=a.makeZRotation(n.z*t);r=a.multiplyMatrices4(s,r),r=a.multiplyMatrices4(l,r),r=a.multiplyMatrices4(u,r),r=a.multiplyMatrices4(c,r),r=a.multiplyMatrices4(o,r),this.position=a.multiplyMatrix4ByVector4(r,new i(this.position.x,this.position.y,this.position.z))},t.prototype.translate=function(t){this.position=o.add(this.position,t)},t.prototype.computeWorldViewMatrices=function(t){this.worldViewMatrix=a.multiplyMatrices4(this.worldMatrix,t)},t.prototype.updateLocalMatrix=function(){this.localMatrix=a.makeIdentity();var t=a.makeTranslation(this.position.x,this.position.y,this.position.z),e=a.makeXRotation(this.rotation.x),n=a.makeYRotation(this.rotation.y),r=a.makeZRotation(this.rotation.z),o=a.makeScale(this.scale.x,this.scale.y,this.scale.z);this.localMatrix=a.multiplyMatrices4(t,this.localMatrix),this.localMatrix=a.multiplyMatrices4(e,this.localMatrix),this.localMatrix=a.multiplyMatrices4(n,this.localMatrix),this.localMatrix=a.multiplyMatrices4(r,this.localMatrix),this.localMatrix=a.multiplyMatrices4(o,this.localMatrix)},t.prototype.updateWorldMatrix=function(t){this.worldMatrix=t?a.multiplyMatrices4(this.localMatrix,t):a.copy(this.localMatrix)},t.prototype.getWorldViewMatrix=function(){return this.worldViewMatrix},t.prototype.getWorldMatrix=function(){return this.worldMatrix},t.prototype.lookAt=function(t,e){var n=a.makeLookAtMatrix(this.position,t,o.up);this.rotation=a.multiplyMatrix4ByVector4(n,new i(this.rotation.x,this.rotation.y,this.rotation.z))},t}(),l=function(){function t(t,e){this.transform=null!=t?t:new u,this.mesh=null!=e?e:null,this.children=[]}return t.prototype.updateLocalMatrices=function(){this.transform.updateLocalMatrix(),this.children.forEach((function(t){t.updateLocalMatrices()}))},t.prototype.updateWorldMatrices=function(t){var e=this;this.transform.updateWorldMatrix(t),this.children.forEach((function(t){t.updateWorldMatrices(e.transform.getWorldMatrix())}))},t.prototype.setParent=function(t){if(this.parent){var e=this.parent.children.indexOf(this);e>=0&&this.parent.children.splice(e,1)}t&&t.children.push(this),this.parent=t},t}(),h=function(){function t(e,n,r,o){this.fieldOfView=e,this.aspectRatio=n,this.near=r,this.far=o,this.transform=new u,null===t.getActiveCamera()&&t.setActiveCamera(this)}return t.prototype.computePerspectiveMatrix=function(){this.perspectiveMatrix=a.makePerspective(this.fieldOfView,this.aspectRatio,this.near,this.far)},t.prototype.getPerspectiveMatrix=function(){return this.perspectiveMatrix},t.getActiveCamera=function(){return t.activeCamera},t.setActiveCamera=function(e){t.activeCamera=e},t.activeCamera=null,t}(),f=function(){function t(t,e){this.context=t,this.program=e,this.vertexBuffer=this.context.createBuffer(),this.normalBuffer=this.context.createBuffer(),this.texCoordsBuffer=this.context.createBuffer(),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),this.positionAttributeLocation=t.getAttribLocation(e,"a_position"),this.texCoordsAttributeLocation=t.getAttribLocation(e,"a_texcoord"),this.normalsAttributeLocation=t.getAttribLocation(e,"a_normal"),this.worldViewMatrixUniformLocation=t.getUniformLocation(e,"u_worldViewMatrix"),this.worldInverseTransposeMatrixLocation=t.getUniformLocation(e,"u_worldInverseTransposeMatrix"),this.reverseLightDirectionLocation=t.getUniformLocation(e,"u_reverseLightDirection")}return t.prototype.getContext=function(){return this.context},t.prototype.loadTexture=function(t){var e=this.context.createTexture();return this.context.bindTexture(this.context.TEXTURE_2D,e),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,this.context.RGBA,this.context.UNSIGNED_BYTE,t),this.context.generateMipmap(this.context.TEXTURE_2D),e},t.prototype.bufferData=function(t){var e,n,r,o=0,i=0;t.forEach((function(t){o+=3*t.mesh.vertices.length})),e=new Float32Array(o),t.forEach((function(t){t.mesh.bufferOffset=i/3,t.mesh.vertices.forEach((function(t){e[i++]=t.x,e[i++]=t.y,e[i++]=t.z}))})),i=0,n=new Float32Array(o),t.forEach((function(t){t.mesh.normals.forEach((function(t){n[i++]=t.x,n[i++]=t.y,n[i++]=t.z}))})),i=0,r=new Float32Array(o),t.forEach((function(t){t.mesh.uvCoords.forEach((function(t){r[i++]=t.x,r[i++]=t.y}))})),this.context.bindBuffer(this.context.ARRAY_BUFFER,this.vertexBuffer),this.context.bufferData(this.context.ARRAY_BUFFER,e,this.context.STATIC_DRAW),this.context.bindBuffer(this.context.ARRAY_BUFFER,this.texCoordsBuffer),this.context.bufferData(this.context.ARRAY_BUFFER,r,this.context.STATIC_DRAW),this.context.bindBuffer(this.context.ARRAY_BUFFER,this.normalBuffer),this.context.bufferData(this.context.ARRAY_BUFFER,n,this.context.STATIC_DRAW)},t.prototype.render=function(t){this.context.viewport(0,0,this.context.canvas.width,this.context.canvas.height),this.context.useProgram(this.program),this.context.enable(this.context.CULL_FACE),this.context.enable(this.context.DEPTH_TEST),this.context.clearColor(.5,.5,.5,1),this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT);for(var e=0;e<t.length;e++)if(null!==t[e].mesh){this.context.uniformMatrix4fv(this.worldViewMatrixUniformLocation,!1,t[e].transform.getWorldViewMatrix().flatten());var n=a.inverse(t[e].transform.getWorldMatrix());this.context.uniformMatrix4fv(this.worldInverseTransposeMatrixLocation,!1,a.transpose(n).flatten());var r=o.normalize(new o(.5,.7,1));this.context.uniform3fv(this.reverseLightDirectionLocation,new Float32Array([r.x,r.y,r.z])),this.context.bindBuffer(this.context.ARRAY_BUFFER,this.vertexBuffer),this.context.enableVertexAttribArray(this.positionAttributeLocation),this.context.vertexAttribPointer(this.positionAttributeLocation,3,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,this.texCoordsBuffer),this.context.enableVertexAttribArray(this.texCoordsAttributeLocation),this.context.vertexAttribPointer(this.texCoordsAttributeLocation,2,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,this.normalBuffer),this.context.enableVertexAttribArray(this.normalsAttributeLocation),this.context.vertexAttribPointer(this.normalsAttributeLocation,3,this.context.FLOAT,!1,0,0),this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,t[e].mesh.texture),this.context.drawArrays(t[e].mesh.drawMode,t[e].mesh.bufferOffset,t[e].mesh.vertices.length)}},t}(),m=function(){function t(){}return t.parse=function(t){var e=[],n=new s;e.push(n);for(var i=[n.vertices,n.uvCoords,n.normals],a=[new o],c=[new r],u=[new o],l=[a,c,u],h={v:function(t){var e=t.map(parseFloat);a.push(new o(e[0],e[1],e[2]))},vn:function(t){var e=t.map(parseFloat);u.push(new o(e[0],e[1],e[2]))},vt:function(t){var e=t.map(parseFloat);c.push(new o(e[0],e[1],e[2]))},f:function(t){for(var e=t.length-2,n=0;n<e;++n)g(t[0]),g(t[n+1]),g(t[n+2])},usemtl:function(t){n.vertices.length>0&&(n=new s,e.push(n),i=[n.vertices,n.uvCoords,n.normals])},o:function(t){n.vertices.length>0&&(n=new s,e.push(n),i=[n.vertices,n.uvCoords,n.normals])}},f=/(\w*)(?: )*(.*)/,m=t.split("\n"),x=0;x<m.length;++x){var d=m[x].trim();if(""!==d&&!d.startsWith("#")){var p=f.exec(d);if(p){var y=p[1],w=(p[2],d.split(/\s+/).slice(1)),v=h[y];v&&v(w)}}}function g(t){t.split("/").forEach((function(t,e){if(t){var n=parseInt(t),r=n+(n>=0?0:l[e].length);i[e].push(l[e][r])}}))}return e},t}(),x=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},d=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},p=function(){function t(){}return t.loadOBJ=function(t){return x(this,void 0,void 0,(function(){var e;return d(this,(function(n){switch(n.label){case 0:return[4,this.loadText(t)];case 1:return e=n.sent(),[2,m.parse(e)]}}))}))},t.loadText=function(t){return x(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,fetch(t)];case 1:return[2,e.sent().text()]}}))}))},t.loadJson=function(t){return x(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,fetch(t)];case 1:return[2,e.sent().json()]}}))}))},t.loadImage=function(t){return x(this,void 0,void 0,(function(){return d(this,(function(e){return[2,new Promise((function(e,n){var r=new Image;r.addEventListener("load",(function(){e(r)})),r.src=t}))]}))}))},t}();function y(t){return t*Math.PI/180}var w,v,g,E={cameraObj:null,forwardVelocity:new o(0,0,0),rightVelocity:new o(0,0,0),maxXRotation:y(89),minXRotation:y(-89),cameraSpeed:20,mouseSensibility:.1,Move:function(t){var e=this.cameraObj,n=this.cameraSpeed*M,r=o.multiply(e.transform.forward,-t.z),i=o.multiply(e.transform.right,t.x),a=o.multiply(o.add(r,i),n);e.transform.translate(a)},Rotate:function(t){var e=this.cameraObj,n=e.transform.rotation,r=this.mouseSensibility*M;n.x-=r*t.x,n.y-=r*t.y,n.x>this.maxXRotation?n.x=this.maxXRotation:n.x<this.minXRotation&&(n.x=this.minXRotation),e.transform.rotation=n,e.transform.rotate(o.zero)}},A={up:!1,down:!1,left:!1,right:!1},M=0,b=0,R=new l,T=new Array;function L(t){var e;M=(t*=.001)-b,b=t,e=new o,A.up&&(e=o.add(e,o.forward)),A.down&&(e=o.add(e,o.backward)),A.right&&(e=o.add(e,o.right)),A.left&&(e=o.add(e,o.left)),E.Move(e),function(){var t=h.getActiveCamera(),e=t.getPerspectiveMatrix(),n=a.makeViewMatrix(t.transform.position,o.add(t.transform.position,t.transform.forward),o.up);R.updateLocalMatrices(),R.updateWorldMatrices();for(var r=0;r<T.length;r++)T[r].transform.computeWorldViewMatrices(a.multiplyMatrices4(n,e))}(),w.render(T),requestAnimationFrame(L)}window.onload=function(){(function(){return t=this,e=void 0,r=function(){var t,e,n;return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(r){switch(r.label){case 0:return t=p.loadImage("./assets/allstar.png"),e=p.loadOBJ("./assets/allstar.obj"),n=[t,e],[4,Promise.all(n).then((function(t){v=t[0],g=t[1]}))];case 1:return r.sent(),[2]}}))},new((n=void 0)||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}));var t,e,n,r})().then((function(){var t;!function(){var t=document.querySelector("#canvas"),e=document.querySelector("#vertex-shader-3d-textured-lit"),n=document.querySelector("#fragment-shader-3d-textured-lit"),r=t.getContext("webgl");if(r){var o=c.loadFromScript(r,e,r.VERTEX_SHADER),i=c.loadFromScript(r,n,r.FRAGMENT_SHADER),a=c.createProgram(r,o,i);w=new f(r,a);var s=t.clientWidth/t.clientHeight,u=y(60);E.cameraObj=new h(u,s,1,2e3),E.cameraObj.computePerspectiveMatrix()}else console.error("Something went wrong while creating webgl context")}(),t=w.loadTexture(v),g.forEach((function(n){n.texture=t,n.drawMode=e.Texture;var r=new l(new u(new o(0,1.5,-5),new o(0,0,0),new o(5,5,5)),n);r.setParent(R),T.push(r)})),w.bufferData(T),function(){document.addEventListener("keydown",(function(t){"w"===t.key?A.up=!0:"s"===t.key?A.down=!0:"a"===t.key?A.left=!0:"d"===t.key?A.right=!0:t.key})),document.addEventListener("keyup",(function(t){"w"===t.key?A.up=!1:"s"===t.key?A.down=!1:"a"===t.key?A.left=!1:"d"===t.key?A.right=!1:t.key}));var t=w.getContext().canvas;function e(t){var e=new o(t.movementY,t.movementX,0);E.Rotate(e)}t.addEventListener("click",(function(t){this.requestPointerLock()})),document.addEventListener("pointerlockchange",(function(){document.pointerLockElement===t?document.addEventListener("mousemove",e):document.removeEventListener("mousemove",e)}))}(),requestAnimationFrame(L)}))}})();
//# sourceMappingURL=main.js.map