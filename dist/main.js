(()=>{"use strict";function t(t){return t*Math.PI/180}function e(t,e,n){return(1-n)*t+n*e}var n,i,r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),o=function(t){function n(e,n,i){var r=t.call(this,null!=e?e:0,null!=n?n:0)||this;return r.z=null!=i?i:0,r}return r(n,t),n.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},n.normalize=function(t){var e=n.magnitude(t);return e>0?n.divide(t,e):new n(0,0,0)},n.add=function(t,e){return new n(t.x+e.x,t.y+e.y,t.z+e.z)},n.subtract=function(t,e){return new n(t.x-e.x,t.y-e.y,t.z-e.z)},n.multiply=function(t,e){return new n(t.x*e,t.y*e,t.z*e)},n.divide=function(t,e){return 0!==e?new n(t.x/e,t.y/e,t.z/e):(console.error("Can't divide by zero, Vector3 was not divided!"),t)},n.dotProduct=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},n.vectorCrossProduct=function(t,e){return new n(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},n.interpolate=function(t,i,r){return new n(e(t.x,i.x,r),e(t.y,i.y,r),e(t.z,i.z,r))},n.zero=new n(0,0,0),n.forward=new n(0,0,-1),n.backward=new n(0,0,1),n.up=new n(0,1,0),n.down=new n(0,-1,0),n.left=new n(-1,0,0),n.right=new n(1,0,0),n}(function(){function t(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}return t.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},t.normalize=function(e){var n=t.magnitude(e);return n>0?t.divide(e,n):new t(0,0)},t.add=function(e,n){return new t(e.x+n.x,e.y+n.y)},t.subtract=function(e,n){return new t(e.x-n.x,e.y-n.y)},t.multiply=function(e,n){return new t(e.x*n,e.y*n)},t.divide=function(e,n){return 0!==n?new t(e.x/n,e.y/n):(console.error("Can't divide by zero, Vector2 was not divided!"),e)},t.dotProduct=function(t,e){return t.x*e.x+t.y*e.y},t}()),a=function(t){function e(e,n,i,r){var o=t.call(this,null!=e?e:0,null!=n?n:0,null!=i?i:0)||this;return o.w=null!=r?r:1,o}return r(e,t),e.forward=new e(0,0,-1,1),e.backward=new e(0,0,1,1),e.up=new e(0,1,0,1),e.down=new e(0,-1,0,1),e.left=new e(-1,0,0,1),e.right=new e(1,0,0,1),e}(o),s=function(){function t(){}return t.loadFromScript=function(t,e,n){var i=t.createShader(n);if(t.shaderSource(i,e.text),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;console.error("Something went wrong when compiling a vertex shader. More info:",t.getShaderInfoLog(i))},t.createProgram=function(t,e,n){var i=t.createProgram();return t.attachShader(i,e),t.attachShader(i,n),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)?i:(console.error("Something went wrong when compiling a vertex shader. More info:",t.getShaderInfoLog(i)),t.deleteProgram(i),null)},t}(),c=function(){function t(t,e,n,i,r,o,a,s,c,l,u,h,f,m,x,d){this.elements=[null!=t?t:0,null!=e?e:0,null!=n?n:0,null!=i?i:0,null!=r?r:0,null!=o?o:0,null!=a?a:0,null!=s?s:0,null!=c?c:0,null!=l?l:0,null!=u?u:0,null!=h?h:0,null!=f?f:0,null!=m?m:0,null!=x?x:0,null!=d?d:0]}return t.prototype.getElementAt=function(t,e){return this.elements[4*e+t]},t.prototype.setElementAt=function(t,e,n){this.elements[4*e+t]=n},t.prototype.flatten=function(){return this.elements},t.makeIdentity=function(){return new t(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.makeScale=function(e,n,i){return new t(e,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1)},t.makeTranslation=function(e,n,i){return new t(1,0,0,0,0,1,0,0,0,0,1,0,e,n,i,1)},t.makeXRotation=function(e){var n=Math.sin(e),i=Math.cos(e);return new t(1,0,0,0,0,i,n,0,0,-n,i,0,0,0,0,1)},t.makeYRotation=function(e){var n=Math.sin(e),i=Math.cos(e);return new t(i,0,-n,0,0,1,0,0,n,0,i,0,0,0,0,1)},t.makeZRotation=function(e){var n=Math.sin(e),i=Math.cos(e);return new t(i,n,0,0,-n,i,0,0,0,0,1,0,0,0,0,1)},t.makePerspective=function(e,n,i,r){var o=Math.tan(.5*Math.PI-.5*e),a=1/(i-r);return new t(o/n,0,0,0,0,o,0,0,0,0,(i+r)*a,-1,0,0,i*r*a*2,0)},t.makeLookAtMatrix=function(e,n,i){var r=o.normalize(o.subtract(e,n)),a=o.normalize(o.vectorCrossProduct(i,r)),s=o.normalize(o.vectorCrossProduct(r,a));return new t(a.x,a.y,a.z,0,s.x,s.y,s.z,0,r.x,r.y,r.z,0,e.x,e.y,e.z,1)},t.makeViewMatrix=function(e,n,i){var r=o.normalize(o.subtract(e,n)),a=o.normalize(o.vectorCrossProduct(i,r)),s=o.vectorCrossProduct(r,a);return new t(a.x,s.x,r.x,0,a.y,s.y,r.y,0,a.z,s.z,r.z,0,-o.dotProduct(a,e),-o.dotProduct(s,e),-o.dotProduct(r,e),1)},t.multiplyMatrix4ByVector4=function(t,e){return new a(e.x*t.getElementAt(0,0)+e.y*t.getElementAt(0,1)+e.z*t.getElementAt(0,2)+e.w*t.getElementAt(0,3),e.x*t.getElementAt(1,0)+e.y*t.getElementAt(1,1)+e.z*t.getElementAt(1,2)+e.w*t.getElementAt(1,3),e.x*t.getElementAt(2,0)+e.y*t.getElementAt(2,1)+e.z*t.getElementAt(2,2)+e.w*t.getElementAt(2,3),e.x*t.getElementAt(3,0)+e.y*t.getElementAt(3,1)+e.z*t.getElementAt(3,2)+e.w*t.getElementAt(3,3))},t.multiplyMatrices4=function(e,n){for(var i=new t,r=0;r<4;r++)for(var o=0;o<4;o++){var a=n.getElementAt(r,0)*e.getElementAt(0,o)+n.getElementAt(r,1)*e.getElementAt(1,o)+n.getElementAt(r,2)*e.getElementAt(2,o)+n.getElementAt(r,3)*e.getElementAt(3,o);i.setElementAt(r,o,a)}return i},t.transpose=function(e){for(var n=new t,i=0;i<4;i++)for(var r=0;r<4;r++)n.setElementAt(i,r,e.getElementAt(r,i));return n},t.copy=function(e){for(var n=new t,i=0;i<4;i++)for(var r=0;r<4;r++)n.setElementAt(i,r,e.getElementAt(i,r));return n},t.inverse=function(e){var n=e.getElementAt(0,0),i=e.getElementAt(1,0),r=e.getElementAt(2,0),o=e.getElementAt(3,0),a=e.getElementAt(0,1),s=e.getElementAt(1,1),c=e.getElementAt(2,1),l=e.getElementAt(3,1),u=e.getElementAt(0,2),h=e.getElementAt(1,2),f=e.getElementAt(2,2),m=e.getElementAt(3,2),x=e.getElementAt(0,3),d=e.getElementAt(1,3),E=e.getElementAt(2,3),p=e.getElementAt(3,3),y=f*p,g=E*m,A=c*p,w=E*l,v=c*m,T=f*l,b=r*p,R=E*o,M=r*m,L=f*o,_=r*l,C=c*o,P=u*d,z=x*h,D=a*d,U=x*s,k=a*h,S=u*s,B=n*d,F=x*i,X=n*h,I=u*i,G=n*s,O=a*i,j=y*s+w*h+v*d-(g*s+A*h+T*d),W=g*i+b*h+L*d-(y*i+R*h+M*d),V=A*i+R*s+_*d-(w*i+b*s+C*d),N=T*i+M*s+C*h-(v*i+L*s+_*h),Y=1/(n*j+a*W+u*V+x*N);return new t(Y*j,Y*W,Y*V,Y*N,Y*(g*a+A*u+T*x-(y*a+w*u+v*x)),Y*(y*n+R*u+M*x-(g*n+b*u+L*x)),Y*(w*n+b*a+C*x-(A*n+R*a+_*x)),Y*(v*n+L*a+_*u-(T*n+M*a+C*u)),Y*(P*l+U*m+k*p-(z*l+D*m+S*p)),Y*(z*o+B*m+I*p-(P*o+F*m+X*p)),Y*(D*o+F*l+G*p-(U*o+B*l+O*p)),Y*(S*o+X*l+O*m-(k*o+I*l+G*m)),Y*(D*f+S*E+z*c-(k*E+P*c+U*f)),Y*(X*E+P*r+F*f-(B*f+I*E+z*r)),Y*(B*c+O*E+U*r-(G*E+D*r+F*c)),Y*(G*f+k*r+I*c-(X*c+O*f+S*r)))},t.compose=function(e,n,i){var r=t.makeIdentity(),o=i.x+i.x,a=i.y+i.y,s=i.z+i.z,c=i.x*o,l=i.x*a,u=i.x*s,h=i.y*a,f=i.y*s,m=i.z*s,x=i.w*o,d=i.w*a,E=i.w*s;return r.elements[0]=(1-(h+m))*n.x,r.elements[1]=(l+E)*n.x,r.elements[2]=(u-d)*n.x,r.elements[3]=0,r.elements[4]=(l-E)*n.y,r.elements[5]=(1-(c+m))*n.y,r.elements[6]=(f+x)*n.y,r.elements[7]=0,r.elements[8]=(u+d)*n.z,r.elements[9]=(f-x)*n.z,r.elements[10]=(1-(c+h))*n.z,r.elements[11]=0,r.elements[12]=e.x,r.elements[13]=e.y,r.elements[14]=e.z,r.elements[15]=1,r},t}(),l=function(){function t(t,e,n,i,r,a){this.position=null!=t?t:new o,this.rotation=null!=e?e:new o,this.scale=null!=n?n:new o(1,1,1),this.up=null!=i?i:o.up,this.right=null!=r?r:o.right,this.forward=null!=a?a:o.forward}return t.prototype.reset=function(){this.position=new o,this.rotation=new o,this.scale=new o(1,1,1)},t.prototype.rotate=function(t){this.rotation=o.add(this.rotation,t),this.computeDirectionVectors()},t.prototype.computeDirectionVectors=function(){var t=c.makeZRotation(this.rotation.z),e=c.makeYRotation(this.rotation.y),n=c.makeXRotation(this.rotation.x),i=c.multiplyMatrices4(e,t);i=c.multiplyMatrices4(n,i),this.up=c.multiplyMatrix4ByVector4(i,a.up),this.forward=c.multiplyMatrix4ByVector4(i,a.forward),this.right=c.multiplyMatrix4ByVector4(i,a.right)},t.prototype.rotateAround=function(t,e,n){var i=c.makeIdentity(),r=c.makeTranslation(-e.x,-e.y,-e.z),o=c.makeTranslation(e.x,e.y,e.z),s=c.makeXRotation(n.x*t),l=c.makeYRotation(n.y*t),u=c.makeZRotation(n.z*t);i=c.multiplyMatrices4(o,i),i=c.multiplyMatrices4(u,i),i=c.multiplyMatrices4(l,i),i=c.multiplyMatrices4(s,i),i=c.multiplyMatrices4(r,i),this.position=c.multiplyMatrix4ByVector4(i,new a(this.position.x,this.position.y,this.position.z))},t.prototype.translate=function(t){this.position=o.add(this.position,t)},t.prototype.updateLocalMatrix=function(){this.localMatrix=c.makeIdentity();var t=c.makeTranslation(this.position.x,this.position.y,this.position.z),e=c.makeXRotation(this.rotation.x),n=c.makeYRotation(this.rotation.y),i=c.makeZRotation(this.rotation.z),r=c.makeScale(this.scale.x,this.scale.y,this.scale.z);this.localMatrix=c.multiplyMatrices4(t,this.localMatrix),this.localMatrix=c.multiplyMatrices4(e,this.localMatrix),this.localMatrix=c.multiplyMatrices4(n,this.localMatrix),this.localMatrix=c.multiplyMatrices4(i,this.localMatrix),this.localMatrix=c.multiplyMatrices4(r,this.localMatrix)},t.prototype.updateWorldMatrix=function(t){this.worldMatrix=t?c.multiplyMatrices4(this.localMatrix,t):c.copy(this.localMatrix)},t.prototype.getWorldMatrix=function(){return this.worldMatrix},t.prototype.lookAt=function(t,e){var n=c.makeLookAtMatrix(this.position,t,o.up);this.rotation=c.multiplyMatrix4ByVector4(n,new a(this.rotation.x,this.rotation.y,this.rotation.z))},t}(),u=function(){function t(e,n,i,r){this.fieldOfView=e,this.aspectRatio=n,this.near=i,this.far=r,this.transform=new l,null===t.getActiveCamera()&&t.setActiveCamera(this)}return t.prototype.computePerspectiveMatrix=function(){this.perspectiveMatrix=c.makePerspective(this.fieldOfView,this.aspectRatio,this.near,this.far)},t.prototype.getPerspectiveMatrix=function(){return this.perspectiveMatrix},t.getActiveCamera=function(){return t.activeCamera},t.setActiveCamera=function(e){t.activeCamera=e},t.activeCamera=null,t}(),h=function(){function t(t,e,n,i){this.id=t,this.name=e,this.localBindMatrix=n,this.inverseBindMatrix=i,this.animatedMatrix=c.multiplyMatrices4(i,n),this.children=[]}return t.prototype.computeInverseBindMatrix=function(t){var e=c.multiplyMatrices4(this.localBindMatrix,t);this.inverseBindMatrix=c.inverse(e),this.children.forEach((function(t){t.computeInverseBindMatrix(e)}))},t}(),f=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function s(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},m=function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},x=function(){function t(){}return t.loadGltf=function(t){return f(this,void 0,void 0,(function(){var e,n,i,r,s,l,u=this;return m(this,(function(f){switch(f.label){case 0:return e={positionData:null,normalData:null,texCoordData:null,indicesData:null,jointData:null,weightData:null,rootJoint:null,jointCount:0},[4,this.loadJson(t)];case 1:return i=f.sent(),r=new URL(t,location.href),[4,Promise.all(i.buffers.map((function(t){var e=new URL(t.uri,r.href);return u.loadArrayBuffer(e.href)})))];case 2:return s=f.sent(),i.meshes.forEach((function(t){t.primitives.forEach((function(t){var n=t.attributes.POSITION,r=t.attributes.NORMAL,o=t.attributes.TEXCOORD_0,a=t.attributes.JOINTS_0,c=t.attributes.WEIGHTS_0,l=t.indices,u=i.accessors[n],h=i.accessors[r],f=i.accessors[o],m=i.accessors[a],x=i.accessors[c],d=i.accessors[l],E=i.bufferViews[u.bufferView],p=i.bufferViews[h.bufferView],y=i.bufferViews[f.bufferView],g=i.bufferViews[m.bufferView],A=i.bufferViews[x.bufferView],w=i.bufferViews[d.bufferView],v=s[E.buffer],T=s[p.buffer],b=s[y.buffer],R=s[g.buffer],M=s[A.buffer],L=s[w.buffer];e.positionData=new Float32Array(v,E.byteOffset,E.byteLength/Float32Array.BYTES_PER_ELEMENT),e.normalData=new Float32Array(T,p.byteOffset,p.byteLength/Float32Array.BYTES_PER_ELEMENT),e.texCoordData=new Float32Array(b,y.byteOffset,y.byteLength/Float32Array.BYTES_PER_ELEMENT),e.jointData=new Uint8Array(R,g.byteOffset,g.byteLength/Uint8Array.BYTES_PER_ELEMENT),e.weightData=new Float32Array(M,A.byteOffset,A.byteLength/Float32Array.BYTES_PER_ELEMENT),e.indicesData=new Uint16Array(L,w.byteOffset,w.byteLength/Uint16Array.BYTES_PER_ELEMENT),console.log("position",e.positionData),console.log("normals",e.normalData),console.log("tex coords",e.texCoordData),console.log("joint ids",e.jointData),console.log("weights",e.weightData),console.log("indices",e.indicesData)}))})),i.skins.forEach((function(t){var r=t.joints.map((function(t){return i.nodes[t]})),u=i.accessors[t.inverseBindMatrices],f=i.bufferViews[u.bufferView],m=s[f.buffer];n=new Float32Array(m,f.byteOffset,f.byteLength/Float32Array.BYTES_PER_ELEMENT);for(var x=new Array(n.length/16),d=0;d<x.length;d++){var E=16*d;x[d]=new c(n[0+E],n[1+E],n[2+E],n[3+E],n[4+E],n[5+E],n[6+E],n[7+E],n[8+E],n[9+E],n[10+E],n[11+E],n[12+E],n[13+E],n[14+E],n[15+E])}for(console.log("FileLoader: ",n),l=new Array(r.length),d=0;d<r.length;d++){var p=c.makeIdentity(),y=new o(0,0,0),g=new a(0,0,0,1),A=new o(1,1,1);r[d].translation&&(y.x=r[d].translation[0],y.y=r[d].translation[1],y.z=r[d].translation[2]),r[d].rotation&&(g.x=r[d].rotation[0],g.y=r[d].rotation[1],g.z=r[d].rotation[2],g.w=r[d].rotation[3]),r[d].scale&&(A.x=r[d].scale[0],A.y=r[d].scale[1],A.z=r[d].scale[2]),p=c.compose(y,A,g),l[d]=new h(d,r[d].name,p,x[d])}var w=function(t){r[t].children&&r[t].children.forEach((function(e){var n=l.find((function(t){return t.name===i.nodes[e].name}));l[t].children.push(n)}))};for(d=0;d<r.length;d++)w(d);e.rootJoint=l[0],e.jointCount=l.length})),[2,e]}}))}))},t.loadText=function(t){return f(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,fetch(t)];case 1:return[2,e.sent().text()]}}))}))},t.loadJson=function(t){return f(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,fetch(t)];case 1:return[2,e.sent().json()]}}))}))},t.loadImage=function(t){return f(this,void 0,void 0,(function(){return m(this,(function(e){return[2,new Promise((function(e,n){var i=new Image;i.addEventListener("load",(function(){e(i)})),i.src=t}))]}))}))},t.loadArrayBuffer=function(t){return f(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,fetch(t)];case 1:return[2,e.sent().arrayBuffer()]}}))}))},t}(),d=function(){function t(t,e,n,i){this.x=t,this.y=e,this.z=n,this.w=i,this.normalize()}return t.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);t>0&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t)},t.prototype.toMatrix4=function(){c.makeIdentity();var t=this.x*this.x,e=this.x*this.y,n=this.x*this.z,i=this.x*this.w,r=this.y*this.y,o=this.y*this.z,a=this.y*this.w,s=this.z*this.z,l=this.z*this.w;return new c(1-2*(r+s),2*(e-l),2*(n+a),0,2*(e+l),1-2*(t+s),2*(o-i),0,2*(n-a),2*(o+i),1-2*(t+r),0,0,0,0,1)},t.fromMatrix4=function(e){var n,i,r,o,a=e.getElementAt(0,0)+e.getElementAt(1,1)+e.getElementAt(2,2);if(a>0){var s=2*Math.sqrt(a+1);n=(e.getElementAt(2,1)-e.getElementAt(1,2))/s,i=(e.getElementAt(0,2)-e.getElementAt(2,0))/s,r=(e.getElementAt(1,0)-e.getElementAt(0,1))/s,o=s/4}else if(e.getElementAt(0,0)>e.getElementAt(1,1)&&e.getElementAt(0,0)>e.getElementAt(2,2)){var c=2*Math.sqrt(1+e.getElementAt(0,0)-e.getElementAt(1,1)-e.getElementAt(2,2));n=c/4,i=(e.getElementAt(0,1)+e.getElementAt(1,0))/c,r=(e.getElementAt(0,2)+e.getElementAt(2,0))/c,o=(e.getElementAt(2,1)-e.getElementAt(1,2))/c}else if(e.getElementAt(1,1)>e.getElementAt(2,2)){var l=2*Math.sqrt(1+e.getElementAt(1,1)-e.getElementAt(0,0)-e.getElementAt(2,2));n=(e.getElementAt(0,1)+e.getElementAt(1,0))/l,i=l/4,r=(e.getElementAt(1,2)+e.getElementAt(2,1))/l,o=(e.getElementAt(0,2)-e.getElementAt(2,0))/l}else{var u=2*Math.sqrt(1+e.getElementAt(2,2)-e.getElementAt(0,0)-e.getElementAt(1,1));n=(e.getElementAt(0,2)+e.getElementAt(2,0))/u,i=(e.getElementAt(1,2)+e.getElementAt(2,1))/u,r=u/4,o=(e.getElementAt(1,0)-e.getElementAt(0,1))/u}return new t(n,i,r,o)},t.interpolate=function(n,i,r){var o=new t(0,0,0,1);return n.x*i.x+n.y*i.y+n.z*i.z+n.w*i.w<0?(o.x=e(n.x,-i.x,r),o.y=e(n.x,-i.y,r),o.z=e(n.x,-i.z,r),o.w=e(n.x,-i.w,r)):(o.x=e(n.x,i.x,r),o.y=e(n.x,i.y,r),o.z=e(n.x,i.z,r),o.w=e(n.x,i.w,r)),o.normalize(),o},t}(),E=function(){function t(t,e){this.position=t,this.rotation=e}return t.prototype.getLocalMatrix=function(){var t=c.makeIdentity(),e=c.makeTranslation(this.position.x,this.position.y,this.position.z),n=this.rotation.toMatrix4();return t=c.multiplyMatrices4(e,t),c.multiplyMatrices4(n,t)},t.interpolate=function(e,n,i){return new t(o.interpolate(e.position,n.position,i),d.interpolate(e.rotation,n.rotation,i))},t}(),p=function(){function e(t){this.xDeg=0,this.transl=0,this.model=t}return e.prototype.doAnimation=function(t){this.currentTime=0,this.animation=t},e.prototype.update=function(e,n){this.xDeg+=t(30)*e,this.transl+=1*e;var i=c.makeXRotation(.5*Math.sin(n));c.makeTranslation(0,this.transl,0),c.inverse(this.model.transform.getWorldMatrix()),function t(e,n){var r=c.multiplyMatrices4(e.localBindMatrix,n);r=c.multiplyMatrices4(i,r),e.animatedMatrix=c.makeIdentity(),e.animatedMatrix=c.multiplyMatrices4(r,e.animatedMatrix),e.animatedMatrix=c.multiplyMatrices4(e.inverseBindMatrix,e.animatedMatrix),e.children&&e.children.forEach((function(e){t(e,r)}))}(this.model.rootJoint,this.model.transform.getWorldMatrix())},e.prototype.increaseAnimationTime=function(t){this.currentTime+=t,this.currentTime>this.animation.lengthInSeconds&&(this.currentTime%=this.animation.lengthInSeconds)},e.prototype.computeCurrentAnimationPose=function(){var t=this.getPreviousAndNextFrames(),e=t[0],n=t[1],i=this.calculateProgression(e,n);return this.interpolatePoses(e,n,i)},e.prototype.applyPoseToJoints=function(t,e,n){var i=this,r=t[e.name],o=c.multiplyMatrices4(r.getLocalMatrix(),n);e.children.forEach((function(e){i.applyPoseToJoints(t,e,o)})),e.animatedMatrix=c.multiplyMatrices4(e.inverseBindMatrix,o)},e.prototype.getPreviousAndNextFrames=function(){for(var t=this.animation.keyframes,e=t[0],n=t[0],i=1;i<t.length&&!((n=t[i]).timestamp>this.currentTime);i++)e=t[i];return[e,n]},e.prototype.calculateProgression=function(t,e){var n=e.timestamp-t.timestamp;return(this.currentTime-t.timestamp)/n},e.prototype.interpolatePoses=function(t,e,n){var i;for(var r in t.pose)i[r]=E.interpolate(t.pose[r],t.pose[r],n);return i},e}(),y=function(){function e(e,n,i,r,a,s,c,u,h,f){this.test=!1,this.renderer=f;var m=this.renderer.getContext();this.positions=m.createBuffer(),this.normals=m.createBuffer(),this.texCoords=m.createBuffer(),this.indices=m.createBuffer(),this.joints=m.createBuffer(),this.weights=m.createBuffer(),this.indexCount=r.length,this.bufferData(this.indices,r,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER),this.bufferData(this.positions,e,WebGLRenderingContext.ARRAY_BUFFER),this.bufferData(this.normals,n,WebGLRenderingContext.ARRAY_BUFFER),this.bufferData(this.texCoords,i,WebGLRenderingContext.ARRAY_BUFFER),this.bufferData(this.joints,a,WebGLRenderingContext.ARRAY_BUFFER),this.bufferData(this.weights,s,WebGLRenderingContext.ARRAY_BUFFER),this.texture=null!=c?c:null,this.rootJoint=null!=u?u:null,this.jointCount=null!=h?h:0,this.animator=new p(this),this.transform=new l(new o(0,0,0),new o(t(-45),0,0),new o(1,1,1)),this.boneTexture=m.createTexture(),m.bindTexture(WebGLRenderingContext.TEXTURE_2D,this.boneTexture),m.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MIN_FILTER,WebGLRenderingContext.NEAREST),m.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MAG_FILTER,WebGLRenderingContext.NEAREST),m.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_S,WebGLRenderingContext.CLAMP_TO_EDGE),m.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_T,WebGLRenderingContext.CLAMP_TO_EDGE)}return e.prototype.bufferData=function(t,e,n){var i=this.renderer.getContext();i.bindBuffer(n,t),i.bufferData(n,e,WebGLRenderingContext.STATIC_DRAW)},e.prototype.doAnimation=function(t){this.animator.doAnimation(t)},e.prototype.update=function(t,e){var n=this.renderer.getContext();this.transform.updateLocalMatrix(),this.transform.updateWorldMatrix(),this.animator.update(t,e);var i=new Float32Array(16*this.jointCount);!function t(e){var n=16*e.id;i.set(e.animatedMatrix.flatten(),n),e.children&&e.children.forEach((function(e){t(e)}))}(this.rootJoint),n.bindTexture(n.TEXTURE_2D,this.boneTexture),this.test||(this.test=!0,console.log("animatedModel: ",i)),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,4,this.jointCount,0,n.RGBA,n.FLOAT,i)},e.prototype.render=function(t){this.renderer.render(t,this)},e}(),g=function(){function t(t,e){this.context=t,this.program=e,this.positionAttributeLocation=t.getAttribLocation(e,"a_position"),this.texCoordsAttributeLocation=t.getAttribLocation(e,"a_texcoord"),this.normalsAttributeLocation=t.getAttribLocation(e,"a_normal"),this.jointsAttributeLocation=t.getAttribLocation(e,"a_joints"),this.weightsAttributeLocation=t.getAttribLocation(e,"a_weights"),this.worldMatrixUniformLocation=t.getUniformLocation(e,"u_worldMatrix"),this.viewMatrixUniformLocation=t.getUniformLocation(e,"u_viewMatrix"),this.projectionMatrixUniformLocation=t.getUniformLocation(e,"u_projectionMatrix"),this.worldInverseTransposeMatrixLocation=t.getUniformLocation(e,"u_worldInverseTransposeMatrix"),this.reverseLightDirectionLocation=t.getUniformLocation(e,"u_reverseLightDirection"),this.jointTextureLocation=t.getUniformLocation(e,"u_jointTexture"),this.jointCountLocation=t.getUniformLocation(e,"u_numJoints")}return t.prototype.getContext=function(){return this.context},t.prototype.loadTexture=function(t){var e=this.context.createTexture();return this.context.bindTexture(this.context.TEXTURE_2D,e),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,this.context.RGBA,this.context.UNSIGNED_BYTE,t),this.context.generateMipmap(this.context.TEXTURE_2D),e},t.prototype.loadTexture2=function(t){var e=this.context.createTexture();return this.context.bindTexture(this.context.TEXTURE_2D,e),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,1,1,0,this.context.RGBA,this.context.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),e},t.prototype.clear=function(){this.context.clearColor(.5,.5,.5,1),this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT)},t.prototype.render=function(t,e){var n=t.getPerspectiveMatrix(),i=c.makeViewMatrix(t.transform.position,o.add(t.transform.position,t.transform.forward),o.up);this.context.viewport(0,0,this.context.canvas.width,this.context.canvas.height),this.context.useProgram(this.program),this.context.enable(this.context.CULL_FACE),this.context.enable(this.context.DEPTH_TEST),this.context.uniform1i(this.jointTextureLocation,1),this.context.uniform1f(this.jointCountLocation,e.jointCount),this.context.uniformMatrix4fv(this.worldMatrixUniformLocation,!1,e.transform.getWorldMatrix().flatten()),this.context.uniformMatrix4fv(this.projectionMatrixUniformLocation,!1,n.flatten()),this.context.uniformMatrix4fv(this.viewMatrixUniformLocation,!1,i.flatten()),this.context.uniform1f(this.jointCountLocation,e.jointCount);var r=c.inverse(e.transform.getWorldMatrix());this.context.uniformMatrix4fv(this.worldInverseTransposeMatrixLocation,!1,c.transpose(r).flatten());var a=o.normalize(new o(.5,.7,1));this.context.uniform3fv(this.reverseLightDirectionLocation,new Float32Array([a.x,a.y,a.z])),this.context.bindBuffer(this.context.ARRAY_BUFFER,e.positions),this.context.enableVertexAttribArray(this.positionAttributeLocation),this.context.vertexAttribPointer(this.positionAttributeLocation,3,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,e.texCoords),this.context.enableVertexAttribArray(this.texCoordsAttributeLocation),this.context.vertexAttribPointer(this.texCoordsAttributeLocation,2,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,e.normals),this.context.enableVertexAttribArray(this.normalsAttributeLocation),this.context.vertexAttribPointer(this.normalsAttributeLocation,3,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,e.joints),this.context.enableVertexAttribArray(this.jointsAttributeLocation),this.context.vertexAttribPointer(this.jointsAttributeLocation,4,this.context.UNSIGNED_BYTE,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,e.weights),this.context.enableVertexAttribArray(this.weightsAttributeLocation),this.context.vertexAttribPointer(this.weightsAttributeLocation,4,this.context.FLOAT,!1,0,0),this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,e.texture),this.context.activeTexture(this.context.TEXTURE1),this.context.bindTexture(this.context.TEXTURE_2D,e.boneTexture),this.context.drawElements(WebGLRenderingContext.TRIANGLES,e.indexCount,this.context.UNSIGNED_SHORT,0)},t}(),A={cameraObj:null,forwardVelocity:new o(0,0,0),rightVelocity:new o(0,0,0),maxXRotation:t(89),minXRotation:t(-89),cameraSpeed:20,mouseSensibility:.1,Move:function(t){var e=this.cameraObj,n=this.cameraSpeed*v,i=o.multiply(e.transform.forward,-t.z),r=o.multiply(e.transform.right,t.x),a=o.multiply(o.add(i,r),n);e.transform.translate(a)},Rotate:function(t){var e=this.cameraObj,n=e.transform.rotation,i=this.mouseSensibility*v;n.x-=i*t.x,n.y-=i*t.y,n.x>this.maxXRotation?n.x=this.maxXRotation:n.x<this.minXRotation&&(n.x=this.minXRotation),e.transform.rotation=n,e.transform.rotate(o.zero)}},w={up:!1,down:!1,left:!1,right:!1},v=0,T=0,b=new Array;function R(t){var e;v=(t*=.001)-T,T=t,e=new o,w.up&&(e=o.add(e,o.forward)),w.down&&(e=o.add(e,o.backward)),w.right&&(e=o.add(e,o.right)),w.left&&(e=o.add(e,o.left)),A.Move(e),b.forEach((function(t){t.update(v,T)})),i.clear(),b.forEach((function(t){t.render(u.getActiveCamera())})),requestAnimationFrame(R)}window.onload=function(){x.loadGltf("./assets/whale.CYCLES.gltf").then((function(e){!function(){var e=document.querySelector("#canvas"),n=document.querySelector("#vertex-shader-3d-textured-skinned"),r=document.querySelector("#fragment-shader-3d-textured-skinned"),o=e.getContext("webgl");if(o){o.getExtension("OES_texture_float");var a=s.loadFromScript(o,n,o.VERTEX_SHADER),c=s.loadFromScript(o,r,o.FRAGMENT_SHADER),l=s.createProgram(o,a,c);i=new g(o,l);var h=e.clientWidth/e.clientHeight,f=t(60);A.cameraObj=new u(f,h,1,2e3),A.cameraObj.computePerspectiveMatrix()}else console.error("Something went wrong while creating webgl context")}();var n=i.loadTexture2(new a(0,0,255,255)),r=new y(e.positionData,e.normalData,e.texCoordData,e.indicesData,e.jointData,e.weightData,n,e.rootJoint,e.jointCount,i);b.push(r),function(){document.addEventListener("keydown",(function(t){"w"===t.key?w.up=!0:"s"===t.key?w.down=!0:"a"===t.key?w.left=!0:"d"===t.key?w.right=!0:t.key})),document.addEventListener("keyup",(function(t){"w"===t.key?w.up=!1:"s"===t.key?w.down=!1:"a"===t.key?w.left=!1:"d"===t.key?w.right=!1:t.key}));var t=i.getContext().canvas;function e(t){var e=new o(t.movementY,t.movementX,0);A.Rotate(e)}t.addEventListener("click",(function(t){this.requestPointerLock()})),document.addEventListener("pointerlockchange",(function(){document.pointerLockElement===t?document.addEventListener("mousemove",e):document.removeEventListener("mousemove",e)}))}(),requestAnimationFrame(R)}))}})();
//# sourceMappingURL=main.js.map